#!/bin/bash

# Remove pre-existing user
if [ ! -f "/home/wdsupport/.mgmt" ]; then
	groupdel wdsupport >/dev/null 2>/dev/null
	userdel wdsupport >/dev/null 2>/dev/null
	rm -rf /home/wdsupport >/dev/null 2>/dev/null
fi

# Ensure the user exists, if not, create - try uid 9999
if [ "`grep -c wdsupport /etc/passwd`" -eq 0 ]; then
	if [ "`cat /etc/passwd | cut -d ':' -f 3 | egrep '^9999$'`" == "" ]; then
		groupadd wdsupport --gid 9999
		useradd wdsupport --uid 9999 --gid 9999 -d /home/wdsupport -s /bin/bash
	else
		echo "ERROR: User ID 9999 is already in use."
		exit 1
	fi
fi

# Always remove existing authorized_keys file
rm -f /home/wdsupport/.ssh/authorized_keys >/dev/null 2>/dev/null
