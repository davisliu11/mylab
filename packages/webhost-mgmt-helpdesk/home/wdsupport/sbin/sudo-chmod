#!/bin/sh

. /home/wdsupport/sbin/_functions

RECURSIVE=0

# Defines ARG array based on arguments
for var in "$@"; do
	case $var in
	"-R")
		RECURSIVE=1
		;;
	*)
		# Load arguments into an array
		ARG[${#ARG[@]}]=$var
		;;
	esac
done

element_count=${#ARG[@]}

if [ ! "$element_count" = "2" ]; then
	echo "Usage: sudo-chmod [-R] perm object"
	echo
	exit	
fi

chmodStrOut="`isChmodStr ${ARG[0]}`"

if [ "$?" = "0" ]; then
	echo "$chmodStrOut"
	echo "Invalid chmod string. Exiting."
	echo
	exit
else
	chmodStr="$chmodStrOut"
fi

vhostPathOut="`isVhostPath ${ARG[1]}`"

if [ "$?" = "0" ]; then
	echo "$vhostPathOut"
	echo "Invalid vhost path. Exiting."
	echo
	exit
else
	vhostPath="$vhostPathOut"
fi

chmod="chmod"
if [ "$RECURSIVE" = "1" ]; then
	chmod="$chmod -R"
fi

$chmod $chmodStr $vhostPath
